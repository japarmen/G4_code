%A and B for each mode
Aa = [    0         0         0         0   89.0000         0    1.0000         0         0         0         0         0
         0         0         0  -89.0000         0         0         0    1.0000         0         0         0         0
         0         0         0         0         0         0         0         0    1.0000         0         0         0
         0         0         0         0         0         0         0         0         0    1.0000         0         0
         0         0         0         0         0         0         0         0         0         0    1.0000         0
         0         0         0         0         0         0         0         0         0         0         0    1.0000
         0         0         0         0   -3.7000         0         0         0         0         0  -89.0000         0
         0         0         0    3.7000         0         0         0         0         0   89.0000         0         0
         0         0         0         0         0         0         0         0    0.0089         0         0         0
         0         0         0         0         0         0         0         0         0         0         0         0
         0         0         0         0         0         0         0         0         0         0         0         0
         0         0         0         0         0         0         0         0         0         0         0         0 ] ;
     
     
Ba = [   0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
   -0.5062    0.5062   -0.5062    0.5062
   -1.3907   -1.3907   -1.3907   -1.3907
   -1.0127    1.0127   -0.0728    1.1160
    0.8653    0.8653    0.8653   -0.8653
   -0.1230    0.1230   -0.1230    0.1230 ] ;


Ab =  [  0         0         0         0   44.5000         0    1.0000         0         0         0         0         0
         0         0         0  -44.5000         0         0         0    1.0000         0         0         0         0
         0         0         0         0         0         0         0         0    1.0000         0         0         0
         0         0         0         0         0         0         0         0         0    1.0000         0         0
         0         0         0         0         0         0         0         0         0         0    1.0000         0
         0         0         0         0         0         0         0         0         0         0         0    1.0000
         0         0         0         0   -3.7000         0         0         0         0         0  -44.5000         0
         0         0         0    3.7000         0         0         0         0         0   44.5000         0         0
         0         0         0         0         0         0         0         0    0.0044         0         0         0
         0         0         0         0         0         0         0         0         0         0         0         0
         0         0         0         0         0         0         0         0         0         0         0         0
         0         0         0         0         0         0         0         0         0         0         0         0 ] ;
  
Bb = [   0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
   -0.7593    0.7593   -0.7593    0.7593
   -2.0861   -2.0861   -2.0861   -2.0861
   -1.5190    1.5190   -0.1092    1.6740
    1.2980    1.2980    1.2980   -1.2980
   -0.1845    0.1845   -0.1845    0.1845 ] ;


Ac = [   0         0         0         0         0         0    1.0000         0         0         0         0         0
         0         0         0         0         0         0         0    1.0000         0         0         0         0
         0         0         0         0         0         0         0         0    1.0000         0         0         0
         0         0         0         0         0         0         0         0         0    1.0000         0         0
         0         0         0         0         0         0         0         0         0         0    1.0000         0
         0         0         0         0         0         0         0         0         0         0         0    1.0000
         0         0         0         0   -3.7000         0         0         0         0         0         0         0
         0         0         0    3.7000         0         0         0         0         0         0         0         0
         0         0         0         0         0         0         0         0         0         0         0         0
         0         0         0         0         0         0         0         0         0         0         0         0
         0         0         0         0         0         0         0         0         0         0         0         0
         0         0         0         0         0         0         0         0         0         0         0         0 ] ;
     
Bc =   [ 0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
   -1.2655    1.2655   -1.2655    1.2655
   -3.4769   -3.4769   -3.4769   -3.4769
   -2.5317    2.5317   -0.1820    2.7900
    2.1633    2.1633    2.1633   -2.1633
   -0.3076    0.3076   -0.3076    0.3076 ] ;


Ad = [   0         0         0    0.7695   -0.0037   -4.4388    0.9254   -0.3265    0.1924         0         0         0
         0         0         0   -3.8707   -0.0014    0.5448    0.3368    0.9413   -0.0227         0         0         0
         0         0         0    3.9242   -1.9091         0   -0.1736    0.0858    0.9811         0         0         0
         0         0         0         0         0         0         0         0         0    1.0000    0.0154    0.1757
         0         0         0         0         0         0         0         0         0         0    0.9962   -0.0872
         0         0         0         0         0         0         0         0         0         0    0.0885    1.0116
         0         0         0         0   -3.6438         0    0.0002         0         0         0         0    4.0000
         0         0         0    3.6299   -0.0560         0         0    0.0004         0         0         0   -2.0000
         0         0         0   -0.3176   -0.6401         0         0         0         0   -4.0000    2.0000         0
         0         0         0         0         0         0         0         0         0         0         0         0
         0         0         0         0         0         0         0         0         0         0         0         0
         0         0         0         0         0         0         0         0         0         0         0         0 ] ;

     
Bd = [     0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
         0         0         0         0
   -1.2149    1.2149   -1.2149    1.4173
   -3.3378   -3.3378   -3.3378   -3.8941
   -1.3354    1.3354   -0.0960    1.7169
    1.1411    1.1411    1.1411   -1.3312
   -0.1622    0.1622   -0.1622    0.1893 ] ;

C = eye(12)  ;

% system transfer function     
Gss1 = ss(Aa,Ba,C,zeros(12,4));
Gss2 = ss(Ab,Bb,C,zeros(12,4));
Gss3 = ss(Ac,Bc,C,zeros(12,4));
Gss4 = ss(Ad,Bd,C,zeros(12,4));

G1 = tf(Gss1);
G2 = tf(Gss2);
G3 = tf(Gss3);
G4 = tf(Gss4);

% define generalized model:
P1 = [ eye(12) , eye(12) , zeros(12) , G1
      eye(12) , -eye(12) , -eye(12) ,  -G1 ];
nmeas = 12;
ncont = 4;

% design H infinity controller
[K1,CL,gamma,info] = hinfsyn(P1,nmeas,ncont);

% design H2 controller
[K1_h2,CL1_h2,gamma_h2] = h2syn(P1,nmeas,ncont);

% [K2,CL2,gamma,info] = hinfsyn(P2,nmeas,ncont);

figure(1);
sigma(G1);
grid on;
legend('Hinf', 'CL', 'G1');

figure(2);
sigma(G2);
grid on;
legend('Hinf', 'CL', 'G2');

figure(3);
sigma(G3);
grid on;
legend('Hinf', 'CL', 'G3');

figure(4);
sigma(G4);
grid on;
legend('Hinf', 'CL', 'G4');
